image: xw-ci:alpine

variables:
 PACKAGE_NAME: 'account-web'
 PORT: 9002
stages:
 - test
 - run_account

test:
 stage: test
 script:
   - mvn test
 tags:
   - docker

run_account:
 stage: run_account
 script:
   - mvn  -Dmaven.test.skip=true clean package
   - cd $PACKAGE_NAME && mvn -Dmaven.test.skip=true docker:build
   - echo "打包完毕，准备运行"
   - docker kill $PACKAGE_NAME && docker rm $PACKAGE_NAME
   - docker run -d -p $PORT:$PORT --name $PACKAGE_NAME $PACKAGE_NAME
   - echo "开始启动..."
 tags:
   - docker
 image: xw-ci:alpine

 stages:
   - test
   - run

 test:
   stage: test
   script:
     - mvn test
   tags:
     - docker

 run:
   stage: run
   script:
     - mvn  -Dmaven.test.skip=true clean package
     - cd account-web && docker:build
     - echo "打包完毕，准备运行"
     - "[ -f /cache/account-web.pid ] && cat /cache/account-web.pid |xargs -i docker kill {}"
     - "[ -f /cache/account-web.pid ] && cat /cache/account-web.pid |xargs -i docker rm {}"
     - docker run -d -p 9002:9002 account-web > /cache/account-web.pid
     - echo "开始启动..."
   tags:
     - docker
